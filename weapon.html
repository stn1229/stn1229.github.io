<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>武器模擬器</title>
        <style>
            @import "test.css";
        </style>
    </head>
    <body>
        <div id="halftop">
            <div class="tablediv">
                <table class="middle" border="2">
                    <tr>
                        <td colspan="5">設定</td>
                    </tr>
                    <tr>
                        <td colspan="5">召喚石</td>
                    </tr>
                    <tr>
                        <td colspan="2">主神加護(預設為終凸)</td>
                        <td><input type="checkbox" name="option" onclick="updatatotal()">0面</td>
                        <td><input type="checkbox" name="option" onclick="updatatotal()">單面</td>
                        <td><input type="checkbox" name="option" onclick="updatatotal()">雙面</td>
                    </tr>
                    <tr>
                        <td colspan="2">方陣加護(預設為終凸)</td>
                        <td><input type="checkbox" name="option" onclick="updatatotal()">0面</td>
                        <td><input type="checkbox" name="option" onclick="updatatotal()">單面</td>
                        <td><input type="checkbox" name="option" onclick="updatatotal()">雙面</td>
                    </tr>
                    <tr>
                        <td>六龍</td>
                        <td><input type="checkbox" name="option" onclick="updatatotal()">無</td>
                        <td><input type="checkbox" name="option" onclick="updatatotal()">0~2凸</td>
                        <td><input type="checkbox" name="option" onclick="updatatotal()">3凸</td>
                        <td><input type="checkbox" name="option" onclick="updatatotal()">終凸</td>
                    </tr>
                    <tr>
                        <td colspan="5">角色</td>
                    </tr>
                    <tr>
                        <td>加護角色</td>
                        <td colspan="2"><input type="checkbox" name="option" onclick="updatatotal()">無</td>
                        <td colspan="2"><input type="checkbox" name="option" onclick="updatatotal()">有</td>
                    </tr>
                </table>
            </div>
            <div class="tablediv">
                <table border="2">
                    <tr>
                        <td colspan="2">
                            <div id="totalhp"><p>HP: <span id="hptotal">0</span></p></div>
                        </td>
                        <td colspan="2">
                            <div id="totalatk"><p>ATK: <span id="atktotal">0</span></p></div>
                        </td>
                    </tr>
                    <tr>
                        <td rowspan="3">
                            <button onclick="deleteweapon('w0')">x</button>
                            <div id="w0" class="plate" data-HP="0" data-ATK="0" data-grandatk="0" ondragover="dragoverhandler(event)" ondrop="drophandler(event)"></div>
                        </td>
                        <td>
                            <button onclick="deleteweapon('w1')">x</button>
                            <div id="w1" class="sub plate" data-HP="0" data-ATK="0" data-grandatk="0" ondragover="dragoverhandler(event)" ondrop="drophandler(event)"></div>
                        </td>
                        <td>
                            <button onclick="deleteweapon('w2')">x</button>
                            <div id="w2" class="sub plate" data-HP="0" data-ATK="0" data-grandatk="0" ondragover="dragoverhandler(event)" ondrop="drophandler(event)"></div>
                        </td>
                        <td>
                            <button onclick="deleteweapon('w3')">x</button>
                            <div id="w3" class="sub plate" data-HP="0" data-ATK="0" data-grandatk="0" ondragover="dragoverhandler(event)" ondrop="drophandler(event)"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <button onclick="deleteweapon('w4')">x</button>
                            <div id="w4" class="sub plate" data-HP="0" data-ATK="0" data-grandatk="0" ondragover="dragoverhandler(event)" ondrop="drophandler(event)"></div>
                        </td>
                        <td>
                            <button onclick="deleteweapon('w5')">x</button>
                            <div id="w5" class="sub plate" data-HP="0" data-ATK="0" data-grandatk="0" ondragover="dragoverhandler(event)" ondrop="drophandler(event)"></div>
                        </td>
                        <td>
                            <button onclick="deleteweapon('w6')">x</button>
                            <div id="w6" class="sub plate" data-HP="0" data-ATK="0" data-grandatk="0" ondragover="dragoverhandler(event)" ondrop="drophandler(event)"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <button onclick="deleteweapon('w7')">x</button>
                            <div id="w7" class="sub plate" data-HP="0" data-ATK="0" data-grandatk="0" ondragover="dragoverhandler(event)" ondrop="drophandler(event)"></div>
                        </td>
                        <td>
                            <button onclick="deleteweapon('w8')">x</button>
                            <div id="w8" class="sub plate" data-HP="0" data-ATK="0" data-grandatk="0" ondragover="dragoverhandler(event)" ondrop="drophandler(event)"></div>
                        </td>
                        <td>
                            <button onclick="deleteweapon('w9')">x</button>
                            <div id="w9" class="sub plate" data-HP="0" data-ATK="0" data-grandatk="0" ondragover="dragoverhandler(event)" ondrop="drophandler(event)"></div>
                        </td>
                    </tr>
                </table>
            </div>
            <div>
                <table class="middle" border="2">
                    <tr>
                        <td colspan="8">結果</td>
                    </tr>
                    <tr>
                        <td><img class="sk" src="sk/1.jpg"></img></td>
                        <td><span id="grandatk" data-grandatk="0">0</span></td>
                        <td><img class="sk" src="sk/2.jpg"></img></td>
                        <td><span id="matk" data-matk="0">0</span></td>
                        <td><img class="sk" src="sk/3.jpg"></img></td>
                        <td><span id="">0</span></td>
                        <td><img class="sk" src="sk/4.jpg"></img></td>
                        <td><span id="">0</span></td>
                    </tr>
                    <tr>
                        <td><img class="sk" src="sk/5.jpg"></img></td>
                        <td><span id="grandatk">0</span></td>
                        <td><img class="sk" src="sk/6.jpg"></img></td>
                        <td><span id="">0</span></td>
                        <td><img class="sk" src="sk/7.jpg"></img></td>
                        <td><span id="">0</span></td>
                        <td><img class="sk" src="sk/8.jpg"></img></td>
                        <td><span id="">0</span></td>
                    </tr>
                    <tr>
                        <td><img class="sk" src="sk/9.jpg"></img></td>
                        <td><span id="grandatk">0</span></td>
                        <td><img class="sk" src="sk/10.jpg"></img></td>
                        <td><span id="">0</span></td>
                        <td><img class="sk" src="sk/11.jpg"></img></td>
                        <td><span id="">0</span></td>
                        <td><img class="sk" src="sk/12.jpg"></img></td>
                        <td><span id="">0</span></td>
                    </tr>
                    <tr>
                        <td><img class="sk" src="sk/14.jpg"></img></td>
                        <td><span id="grandatk">0</span></td>
                        <td><img class="sk" src="sk/15.jpg"></img></td>
                        <td><span id="">0</span></td>
                        <td><img class="sk" src="sk/16.jpg"></img></td>
                        <td><span id="">0</span></td>
                        <td><img class="sk" src="sk/17.jpg"></img></td>
                        <td><span id="">0</span></td>
                    </tr>
                    <tr>
                        <td><img class="sk" src="sk/18.jpg"></img></td>
                        <td><span id="grandatk">0</span></td>
                        <td><img class="sk" src="sk/19.jpg"></img></td>
                        <td><span id="">0</span></td>
                        <td><img class="sk" src="sk/20.jpg"></img></td>
                        <td><span id="">0</span></td>
                        <td><img class="sk" src="sk/21.jpg"></img></td>
                        <td><span id="">0</span></td>
                    </tr>
                    <tr>
                        <td><img class="sk" src="sk/22.jpg"></img></td>
                        <td><span id="grandatk">0</span></td>
                        <td><img class="sk" src="sk/23.jpg"></img></td>
                        <td><span id="">0</span></td>
                        <td><img class="sk" src="sk/24.jpg"></img></td>
                        <td><span id="">0</span></td>
                    </tr>
                </table>
            </div>
        </div>
        <div id="halfbutton">
            <div>分類</div>
            圖(例如)
            <img id="wex1" src="weapon/ex1.jpg" data-HP="310" data-ATK="3409" draggable="true" ondragstart="dragstarthandler(event)"></img>
            <img id="wex2" src="weapon/ex2.jpg" data-HP="377" data-ATK="3360" draggable="true" ondragstart="dragstarthandler(event)"></img>
            <img id="w36" src="weapon/4-36.jpg" title="スカイエース&#10英傑大&#10亂舞小" data-HP="249" data-ATK="3554" data-grandatk="12%" draggable="true" ondragstart="dragstarthandler(event)"></img>
            <img id="w54" src="weapon/4-54.jpg" data-HP="281" data-ATK="3369" draggable="true" ondragstart="dragstarthandler(event)"></img>
            <img id="w72" src="weapon/4-72.jpg" data-HP="286" data-ATK="3345" draggable="true" ondragstart="dragstarthandler(event)"></img>

        </div>
    </body>
    <script>
        function deleteweapon(id){
            var now=document.getElementById(id);
            var empty=now.firstChild;
            now.removeChild(empty);
            now.setAttribute("data-HP",0);
            now.setAttribute("data-ATK",0);
            now.setAttribute("data-grandatk",0);
            updatatotal();
        }
        function dragstarthandler(event){
            
            event.dataTransfer.setData("text", event.target.id);
            
        }
        function dragoverhandler(event){
            event.preventDefault();
        }
        function drophandler(event){
            event.preventDefault();

            var old=event.currentTarget.firstChild;            
            var data=event.dataTransfer.getData("text");
            var img=document.getElementById(data);
            var imgclone=img.cloneNode(true);
            var div=event.target;
            /*
            if(div.id=="w0"){
                imgclone.style.transform="rotate(90deg)";
            }
            */
            event.currentTarget.appendChild(imgclone);
            event.currentTarget.setAttribute("data-HP",img.getAttribute("data-HP"));
            event.currentTarget.setAttribute("data-ATK",img.getAttribute("data-ATK"));
            event.currentTarget.setAttribute("data-grandatk",img.getAttribute("data-grandatk"));
            console.log(div.outerHTML);

            updatatotal();

            event.currentTarget.removeChild(old);
        }
        function updatatotal(){
            var totalhp=0;
            var totalatk=0;
            var grandatk=0;
            var plates=document.getElementsByClassName("plate");

            for(var i=0;i<plates.length;i++){
                var hp=parseInt(plates[i].getAttribute("data-HP"));
                var atk=parseInt(plates[i].getAttribute("data-ATK"));
                var gatk=parseInt(plates[i].getAttribute("data-grandatk"))
                totalhp+=hp;
                totalatk+=atk;
                grandatk+=gatk;
            }

            var options=document.getElementsByName("option");
            if(options[0].checked){
                document.getElementById("grandatk").textContent=grandatk+"%";
            }
            else if(options[1].checked){
                document.getElementById("grandatk").textContent=grandatk*2.5+"%";
            }
            else if(options[2].checked)document.getElementById("grandatk").textContent=grandatk*4+"%";
            else document.getElementById("grandatk").textContent=grandatk+"%";
            
            document.getElementById("hptotal").textContent=totalhp;
            document.getElementById("atktotal").textContent=totalatk;
        }
    </script>
</html>